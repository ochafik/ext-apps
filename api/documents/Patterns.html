<!DOCTYPE html><html class="default" lang="en" data-base="../"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Patterns | @modelcontextprotocol/ext-apps - v1.0.0</title><meta name="description" content="Documentation for @modelcontextprotocol/ext-apps"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script><link rel="stylesheet" href="../assets/typedoc-github-style.css"/></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="../index.html" class="title">@modelcontextprotocol/ext-apps - v1.0.0</a><div id="tsd-toolbar-links"><a href="https://github.com/modelcontextprotocol/ext-apps">GitHub</a><a href="https://github.com/modelcontextprotocol/ext-apps/blob/main/specification/2026-01-26/apps.mdx">Specification</a></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb" aria-label="Breadcrumb"><li><a href="" aria-current="page">Patterns</a></li></ul></div><div class="tsd-panel tsd-typography"><h1 id="mcp-apps-patterns" class="tsd-anchor-link">MCP Apps Patterns<a href="#mcp-apps-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1>
<p>This document covers common patterns and recipes for building MCP Apps.</p>
<h2 id="tools-that-are-private-to-apps" class="tsd-anchor-link">Tools that are private to Apps<a href="#tools-that-are-private-to-apps" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>Set <a href="../interfaces/app.McpUiToolMeta.html#visibility" class="tsd-kind-property"><code>Tool._meta.ui.visibility</code></a> to <code>[&quot;app&quot;]</code> to make tools only callable by Apps (hidden from the model). This is useful for UI-driven actions like updating quantities, toggling settings, or other interactions that shouldn't appear in the model's tool list.</p>
<!-- prettier-ignore -->
<pre><code class="ts"><span class="hl-0">registerAppTool</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">server</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;update-quantity&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-2">&quot;Update item quantity in cart&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">inputSchema:</span><span class="hl-1"> { </span><span class="hl-4">itemId:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-0">string</span><span class="hl-1">(), </span><span class="hl-4">quantity:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-0">number</span><span class="hl-1">() },</span><br/><span class="hl-1">    </span><span class="hl-4">_meta:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">ui:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">resourceUri:</span><span class="hl-1"> </span><span class="hl-2">&quot;ui://shop/cart.html&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">visibility:</span><span class="hl-1"> [</span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-3">async</span><span class="hl-1"> ({ </span><span class="hl-4">itemId</span><span class="hl-1">, </span><span class="hl-4">quantity</span><span class="hl-1"> }) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">cart</span><span class="hl-1"> = </span><span class="hl-9">await</span><span class="hl-1"> </span><span class="hl-0">updateCartItem</span><span class="hl-1">(</span><span class="hl-4">itemId</span><span class="hl-1">, </span><span class="hl-4">quantity</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-9">return</span><span class="hl-1"> { </span><span class="hl-4">content:</span><span class="hl-1"> [{ </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-2">&quot;text&quot;</span><span class="hl-1">, </span><span class="hl-4">text:</span><span class="hl-1"> </span><span class="hl-10">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">(</span><span class="hl-4">cart</span><span class="hl-1">) }] };</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p><em>See <a href="https://github.com/modelcontextprotocol/ext-apps/tree/main/examples/system-monitor-server"><code>examples/system-monitor-server/</code></a> for a full implementation of this pattern.</em></p>
<h2 id="reading-large-amounts-of-data-via-chunked-tool-calls" class="tsd-anchor-link">Reading large amounts of data via chunked tool calls<a href="#reading-large-amounts-of-data-via-chunked-tool-calls" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>Some host platforms have size limits on tool call responses, so large files (PDFs, images, etc.) cannot be sent in a single response. Use an app-only tool with chunked responses to bypass these limits while keeping the data out of model context.</p>
<p><strong>Server-side</strong>: Register an app-only tool that returns data in chunks with pagination metadata:</p>
<!-- prettier-ignore -->
<pre><code class="tsx"><span class="hl-11">// Define the chunk response schema</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">DataChunkSchema</span><span class="hl-1"> = </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-0">object</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">bytes:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-0">string</span><span class="hl-1">(), </span><span class="hl-11">// base64-encoded data</span><br/><span class="hl-1">  </span><span class="hl-4">offset:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-0">number</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-4">byteCount:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-0">number</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-4">totalBytes:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-0">number</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-4">hasMore:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-0">boolean</span><span class="hl-1">(),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">MAX_CHUNK_BYTES</span><span class="hl-1"> = </span><span class="hl-13">500</span><span class="hl-1"> * </span><span class="hl-13">1024</span><span class="hl-1">; </span><span class="hl-11">// 500KB per chunk</span><br/><br/><span class="hl-0">registerAppTool</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">server</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;read_data_bytes&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">title:</span><span class="hl-1"> </span><span class="hl-2">&quot;Read Data Bytes&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-2">&quot;Load binary data in chunks&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">inputSchema:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-0">string</span><span class="hl-1">().</span><span class="hl-0">describe</span><span class="hl-1">(</span><span class="hl-2">&quot;Resource identifier&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-4">offset:</span><span class="hl-1"> </span><span class="hl-4">z</span><span class="hl-1">.</span><span class="hl-0">number</span><span class="hl-1">().</span><span class="hl-0">min</span><span class="hl-1">(</span><span class="hl-13">0</span><span class="hl-1">).</span><span class="hl-0">default</span><span class="hl-1">(</span><span class="hl-13">0</span><span class="hl-1">).</span><span class="hl-0">describe</span><span class="hl-1">(</span><span class="hl-2">&quot;Byte offset&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-4">byteCount:</span><span class="hl-1"> </span><span class="hl-4">z</span><br/><span class="hl-1">        .</span><span class="hl-0">number</span><span class="hl-1">()</span><br/><span class="hl-1">        .</span><span class="hl-0">default</span><span class="hl-1">(</span><span class="hl-10">MAX_CHUNK_BYTES</span><span class="hl-1">)</span><br/><span class="hl-1">        .</span><span class="hl-0">describe</span><span class="hl-1">(</span><span class="hl-2">&quot;Bytes to read&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">outputSchema:</span><span class="hl-1"> </span><span class="hl-4">DataChunkSchema</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-11">// Hidden from model - only callable by the App</span><br/><span class="hl-1">    </span><span class="hl-4">_meta:</span><span class="hl-1"> { </span><span class="hl-4">ui:</span><span class="hl-1"> { </span><span class="hl-4">visibility:</span><span class="hl-1"> [</span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">] } },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-3">async</span><span class="hl-1"> ({ </span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1">, </span><span class="hl-4">byteCount</span><span class="hl-1"> }): </span><span class="hl-12">Promise</span><span class="hl-1">&lt;</span><span class="hl-12">CallToolResult</span><span class="hl-1">&gt; </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">data</span><span class="hl-1"> = </span><span class="hl-9">await</span><span class="hl-1"> </span><span class="hl-0">loadData</span><span class="hl-1">(</span><span class="hl-4">id</span><span class="hl-1">); </span><span class="hl-11">// Your data loading logic</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">chunk</span><span class="hl-1"> = </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-0">slice</span><span class="hl-1">(</span><span class="hl-4">offset</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1"> + </span><span class="hl-4">byteCount</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-9">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">content:</span><span class="hl-1"> [{ </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-2">&quot;text&quot;</span><span class="hl-1">, </span><span class="hl-4">text:</span><span class="hl-1"> </span><span class="hl-2">`</span><span class="hl-3">${</span><span class="hl-4">chunk</span><span class="hl-18">.</span><span class="hl-4">length</span><span class="hl-3">}</span><span class="hl-2"> bytes at </span><span class="hl-3">${</span><span class="hl-4">offset</span><span class="hl-3">}</span><span class="hl-2">`</span><span class="hl-1"> }],</span><br/><span class="hl-1">      </span><span class="hl-4">structuredContent:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">bytes:</span><span class="hl-1"> </span><span class="hl-4">Buffer</span><span class="hl-1">.</span><span class="hl-0">from</span><span class="hl-1">(</span><span class="hl-4">chunk</span><span class="hl-1">).</span><span class="hl-0">toString</span><span class="hl-1">(</span><span class="hl-2">&quot;base64&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">        </span><span class="hl-4">offset</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">byteCount:</span><span class="hl-1"> </span><span class="hl-4">chunk</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">totalBytes:</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">hasMore:</span><span class="hl-1"> </span><span class="hl-4">offset</span><span class="hl-1"> + </span><span class="hl-4">chunk</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &lt; </span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">,</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p><strong>Client-side</strong>: Loop calling the tool until all chunks are received:</p>
<!-- prettier-ignore -->
<pre><code class="tsx"><span class="hl-3">interface</span><span class="hl-1"> </span><span class="hl-12">DataChunk</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">bytes</span><span class="hl-1">: </span><span class="hl-12">string</span><span class="hl-1">; </span><span class="hl-11">// base64</span><br/><span class="hl-1">  </span><span class="hl-4">offset</span><span class="hl-1">: </span><span class="hl-12">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">byteCount</span><span class="hl-1">: </span><span class="hl-12">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">totalBytes</span><span class="hl-1">: </span><span class="hl-12">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">hasMore</span><span class="hl-1">: </span><span class="hl-12">boolean</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">async</span><span class="hl-1"> </span><span class="hl-3">function</span><span class="hl-1"> </span><span class="hl-0">loadDataInChunks</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-12">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">onProgress</span><span class="hl-1">?: (</span><span class="hl-4">loaded</span><span class="hl-1">: </span><span class="hl-12">number</span><span class="hl-1">, </span><span class="hl-4">total</span><span class="hl-1">: </span><span class="hl-12">number</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-12">void</span><span class="hl-1">,</span><br/><span class="hl-1">): </span><span class="hl-12">Promise</span><span class="hl-1">&lt;</span><span class="hl-12">Uint8Array</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">CHUNK_SIZE</span><span class="hl-1"> = </span><span class="hl-13">500</span><span class="hl-1"> * </span><span class="hl-13">1024</span><span class="hl-1">; </span><span class="hl-11">// 500KB chunks</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">chunks</span><span class="hl-1">: </span><span class="hl-12">Uint8Array</span><span class="hl-1">[] = [];</span><br/><span class="hl-1">  </span><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-4">offset</span><span class="hl-1"> = </span><span class="hl-13">0</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-4">totalBytes</span><span class="hl-1"> = </span><span class="hl-13">0</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-4">hasMore</span><span class="hl-1"> = </span><span class="hl-3">true</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-9">while</span><span class="hl-1"> (</span><span class="hl-4">hasMore</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">result</span><span class="hl-1"> = </span><span class="hl-9">await</span><span class="hl-1"> </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">callServerTool</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;read_data_bytes&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">arguments:</span><span class="hl-1"> { </span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">offset</span><span class="hl-1">, </span><span class="hl-4">byteCount:</span><span class="hl-1"> </span><span class="hl-10">CHUNK_SIZE</span><span class="hl-1"> },</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-9">if</span><span class="hl-1"> (</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">isError</span><span class="hl-1"> || !</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">structuredContent</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-9">throw</span><span class="hl-1"> </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Failed to load data chunk&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">chunk</span><span class="hl-1"> = </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">structuredContent</span><span class="hl-1"> </span><span class="hl-9">as</span><span class="hl-1"> </span><span class="hl-12">unknown</span><span class="hl-1"> </span><span class="hl-9">as</span><span class="hl-1"> </span><span class="hl-12">DataChunk</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">totalBytes</span><span class="hl-1"> = </span><span class="hl-4">chunk</span><span class="hl-1">.</span><span class="hl-4">totalBytes</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">hasMore</span><span class="hl-1"> = </span><span class="hl-4">chunk</span><span class="hl-1">.</span><span class="hl-4">hasMore</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-11">// Decode base64 to bytes</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">binaryString</span><span class="hl-1"> = </span><span class="hl-0">atob</span><span class="hl-1">(</span><span class="hl-4">chunk</span><span class="hl-1">.</span><span class="hl-4">bytes</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">bytes</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Uint8Array</span><span class="hl-1">(</span><span class="hl-4">binaryString</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-9">for</span><span class="hl-1"> (</span><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-4">i</span><span class="hl-1"> = </span><span class="hl-13">0</span><span class="hl-1">; </span><span class="hl-4">i</span><span class="hl-1"> &lt; </span><span class="hl-4">binaryString</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">; </span><span class="hl-4">i</span><span class="hl-1">++) {</span><br/><span class="hl-1">      </span><span class="hl-4">bytes</span><span class="hl-1">[</span><span class="hl-4">i</span><span class="hl-1">] = </span><span class="hl-4">binaryString</span><span class="hl-1">.</span><span class="hl-0">charCodeAt</span><span class="hl-1">(</span><span class="hl-4">i</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-4">chunks</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><span class="hl-4">bytes</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-4">offset</span><span class="hl-1"> += </span><span class="hl-4">chunk</span><span class="hl-1">.</span><span class="hl-4">byteCount</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">onProgress</span><span class="hl-1">?.(</span><span class="hl-4">offset</span><span class="hl-1">, </span><span class="hl-4">totalBytes</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-11">// Combine all chunks into single array</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">fullData</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Uint8Array</span><span class="hl-1">(</span><span class="hl-4">totalBytes</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-4">pos</span><span class="hl-1"> = </span><span class="hl-13">0</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-9">for</span><span class="hl-1"> (</span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">chunk</span><span class="hl-1"> </span><span class="hl-3">of</span><span class="hl-1"> </span><span class="hl-4">chunks</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">fullData</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><span class="hl-4">chunk</span><span class="hl-1">, </span><span class="hl-4">pos</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">pos</span><span class="hl-1"> += </span><span class="hl-4">chunk</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-9">return</span><span class="hl-1"> </span><span class="hl-4">fullData</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-11">// Usage: load data with progress updates</span><br/><span class="hl-0">loadDataInChunks</span><span class="hl-1">(</span><span class="hl-4">resourceId</span><span class="hl-1">, (</span><span class="hl-4">loaded</span><span class="hl-1">, </span><span class="hl-4">total</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Loading: </span><span class="hl-3">${</span><span class="hl-4">Math</span><span class="hl-18">.</span><span class="hl-0">round</span><span class="hl-18">((</span><span class="hl-4">loaded</span><span class="hl-18"> </span><span class="hl-1">/</span><span class="hl-18"> </span><span class="hl-4">total</span><span class="hl-18">) </span><span class="hl-1">*</span><span class="hl-18"> </span><span class="hl-13">100</span><span class="hl-18">)</span><span class="hl-3">}</span><span class="hl-2">%`</span><span class="hl-1">);</span><br/><span class="hl-1">}).</span><span class="hl-0">then</span><span class="hl-1">((</span><span class="hl-4">data</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Loaded </span><span class="hl-3">${</span><span class="hl-4">data</span><span class="hl-18">.</span><span class="hl-4">length</span><span class="hl-3">}</span><span class="hl-2"> bytes`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><em>See <a href="https://github.com/modelcontextprotocol/ext-apps/tree/main/examples/pdf-server"><code>examples/pdf-server/</code></a> for a full implementation of this pattern.</em></p>
<h2 id="giving-errors-back-to-model" class="tsd-anchor-link">Giving errors back to model<a href="#giving-errors-back-to-model" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p><strong>Server-side</strong>: Tool handler validates inputs and returns <code>{ isError: true, content: [...] }</code>. The model receives this error through the normal tool call response.</p>
<p><strong>Client-side</strong>: If a runtime error occurs (e.g., API failure, permission denied, resource unavailable), use <a href="../classes/app.App.html#updatemodelcontext" class="tsd-kind-method"><code>updateModelContext</code></a> to inform the model:</p>
<!-- prettier-ignore -->
<pre><code class="ts"><span class="hl-9">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">_stream</span><span class="hl-1"> = </span><span class="hl-9">await</span><span class="hl-1"> </span><span class="hl-4">navigator</span><span class="hl-1">.</span><span class="hl-4">mediaDevices</span><span class="hl-1">.</span><span class="hl-0">getUserMedia</span><span class="hl-1">({ </span><span class="hl-4">audio:</span><span class="hl-1"> </span><span class="hl-3">true</span><span class="hl-1"> });</span><br/><span class="hl-1">  </span><span class="hl-11">// ... use _stream for transcription</span><br/><span class="hl-1">} </span><span class="hl-9">catch</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-11">// Inform the model that the app is in a degraded state</span><br/><span class="hl-1">  </span><span class="hl-9">await</span><span class="hl-1"> </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">updateModelContext</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">content:</span><span class="hl-1"> [</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-2">&quot;text&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">text:</span><span class="hl-1"> </span><span class="hl-2">&quot;Error: transcription unavailable&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h2 id="matching-host-styling-css-variables-theme-and-fonts" class="tsd-anchor-link">Matching host styling (CSS variables, theme, and fonts)<a href="#matching-host-styling-css-variables-theme-and-fonts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>Use the SDK's style helpers to apply host styling, then reference them in your CSS:</p>
<ul>
<li><strong>CSS variables</strong> — Use <code>var(--color-background-primary)</code>, etc. in your CSS</li>
<li><strong>Theme</strong> — Use <code>[data-theme=&quot;dark&quot;]</code> selectors or <code>light-dark()</code> function for theme-aware styles</li>
<li><strong>Fonts</strong> — Use <code>var(--font-sans)</code> or <code>var(--font-mono)</code> with fallbacks (e.g., <code>font-family: var(--font-sans, system-ui, sans-serif)</code>)</li>
</ul>
<p><strong>Vanilla JS:</strong></p>
<!-- prettier-ignore -->
<pre><code class="tsx"><span class="hl-3">function</span><span class="hl-1"> </span><span class="hl-0">applyHostContext</span><span class="hl-1">(</span><span class="hl-4">ctx</span><span class="hl-1">: </span><span class="hl-12">McpUiHostContext</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-9">if</span><span class="hl-1"> (</span><span class="hl-4">ctx</span><span class="hl-1">.</span><span class="hl-4">theme</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">applyDocumentTheme</span><span class="hl-1">(</span><span class="hl-4">ctx</span><span class="hl-1">.</span><span class="hl-4">theme</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-9">if</span><span class="hl-1"> (</span><span class="hl-4">ctx</span><span class="hl-1">.</span><span class="hl-4">styles</span><span class="hl-1">?.</span><span class="hl-4">variables</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">applyHostStyleVariables</span><span class="hl-1">(</span><span class="hl-4">ctx</span><span class="hl-1">.</span><span class="hl-4">styles</span><span class="hl-1">.</span><span class="hl-4">variables</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-9">if</span><span class="hl-1"> (</span><span class="hl-4">ctx</span><span class="hl-1">.</span><span class="hl-4">styles</span><span class="hl-1">?.</span><span class="hl-4">css</span><span class="hl-1">?.</span><span class="hl-4">fonts</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">applyHostFonts</span><span class="hl-1">(</span><span class="hl-4">ctx</span><span class="hl-1">.</span><span class="hl-4">styles</span><span class="hl-1">.</span><span class="hl-4">css</span><span class="hl-1">.</span><span class="hl-4">fonts</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-11">// Apply when host context changes</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-4">onhostcontextchanged</span><span class="hl-1"> = </span><span class="hl-4">applyHostContext</span><span class="hl-1">;</span><br/><br/><span class="hl-11">// Apply initial styles after connecting</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">connect</span><span class="hl-1">().</span><span class="hl-0">then</span><span class="hl-1">(() </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">ctx</span><span class="hl-1"> = </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">getHostContext</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-9">if</span><span class="hl-1"> (</span><span class="hl-4">ctx</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">applyHostContext</span><span class="hl-1">(</span><span class="hl-4">ctx</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>React:</strong></p>
<!-- prettier-ignore -->
<pre><code class="tsx"><span class="hl-3">function</span><span class="hl-1"> </span><span class="hl-0">MyApp</span><span class="hl-1">() {</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> { </span><span class="hl-10">app</span><span class="hl-1"> } = </span><span class="hl-0">useApp</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">appInfo:</span><span class="hl-1"> { </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;MyApp&quot;</span><span class="hl-1">, </span><span class="hl-4">version:</span><span class="hl-1"> </span><span class="hl-2">&quot;1.0.0&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-4">capabilities:</span><span class="hl-1"> {},</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-11">// Apply all host styles (variables, theme, fonts)</span><br/><span class="hl-1">  </span><span class="hl-0">useHostStyles</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">, </span><span class="hl-4">app</span><span class="hl-1">?.</span><span class="hl-0">getHostContext</span><span class="hl-1">());</span><br/><br/><span class="hl-1">  </span><span class="hl-9">return</span><span class="hl-1"> (</span><br/><span class="hl-1">    </span><span class="hl-15">&lt;</span><span class="hl-16">div</span><br/><span class="hl-1">      </span><span class="hl-7">style</span><span class="hl-1">=</span><span class="hl-3">{</span><span class="hl-18">{</span><br/><span class="hl-18">        </span><span class="hl-4">background:</span><span class="hl-18"> </span><span class="hl-2">&quot;var(--color-background-primary)&quot;</span><span class="hl-18">,</span><br/><span class="hl-18">        </span><span class="hl-4">fontFamily:</span><span class="hl-18"> </span><span class="hl-2">&quot;var(--font-sans)&quot;</span><span class="hl-18">,</span><br/><span class="hl-18">      }</span><span class="hl-3">}</span><br/><span class="hl-1">    </span><span class="hl-15">&gt;</span><br/><span class="hl-1">      </span><span class="hl-15">&lt;</span><span class="hl-16">p</span><span class="hl-15">&gt;</span><span class="hl-1">Styled with host CSS variables and fonts</span><span class="hl-15">&lt;/</span><span class="hl-16">p</span><span class="hl-15">&gt;</span><br/><span class="hl-1">      </span><span class="hl-15">&lt;</span><span class="hl-16">p</span><span class="hl-1"> </span><span class="hl-7">className</span><span class="hl-1">=</span><span class="hl-2">&quot;theme-aware&quot;</span><span class="hl-15">&gt;</span><span class="hl-1">Uses [data-theme] selectors</span><span class="hl-15">&lt;/</span><span class="hl-16">p</span><span class="hl-15">&gt;</span><br/><span class="hl-1">    </span><span class="hl-15">&lt;/</span><span class="hl-16">div</span><span class="hl-15">&gt;</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><em>See <a href="https://github.com/modelcontextprotocol/ext-apps/tree/main/examples/basic-server-vanillajs"><code>examples/basic-server-vanillajs/</code></a> and <a href="https://github.com/modelcontextprotocol/ext-apps/tree/main/examples/basic-server-react"><code>examples/basic-server-react/</code></a> for full implementations of this pattern.</em></p>
<h2 id="entering-exiting-fullscreen" class="tsd-anchor-link">Entering / Exiting fullscreen<a href="#entering-exiting-fullscreen" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>Toggle fullscreen mode by calling <a href="../classes/app.App.html#requestdisplaymode" class="tsd-kind-method"><code>requestDisplayMode</code></a>:</p>
<!-- prettier-ignore -->
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">ctx</span><span class="hl-1"> = </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">getHostContext</span><span class="hl-1">();</span><br/><span class="hl-9">if</span><span class="hl-1"> (</span><span class="hl-4">ctx</span><span class="hl-1">?.</span><span class="hl-4">availableDisplayModes</span><span class="hl-1">?.</span><span class="hl-0">includes</span><span class="hl-1">(</span><span class="hl-2">&quot;fullscreen&quot;</span><span class="hl-1">)) {</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">target</span><span class="hl-1"> = </span><span class="hl-4">ctx</span><span class="hl-1">.</span><span class="hl-4">displayMode</span><span class="hl-1"> === </span><span class="hl-2">&quot;fullscreen&quot;</span><span class="hl-1"> ? </span><span class="hl-2">&quot;inline&quot;</span><span class="hl-1"> : </span><span class="hl-2">&quot;fullscreen&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">result</span><span class="hl-1"> = </span><span class="hl-9">await</span><span class="hl-1"> </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">requestDisplayMode</span><span class="hl-1">({ </span><span class="hl-4">mode:</span><span class="hl-1"> </span><span class="hl-4">target</span><span class="hl-1"> });</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Now in:&quot;</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">mode</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Listen for display mode changes via <a href="../classes/app.App.html#onhostcontextchanged" class="tsd-kind-accessor"><code>onhostcontextchanged</code></a> to update your UI:</p>
<!-- prettier-ignore -->
<pre><code class="ts"><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">onhostcontextchanged</span><span class="hl-1"> = (</span><span class="hl-4">params</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-9">if</span><span class="hl-1"> (</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">displayMode</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">isFullscreen</span><span class="hl-1"> = </span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">displayMode</span><span class="hl-1"> === </span><span class="hl-2">&quot;fullscreen&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">document</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">classList</span><span class="hl-1">.</span><span class="hl-0">toggle</span><span class="hl-1">(</span><span class="hl-2">&quot;fullscreen&quot;</span><span class="hl-1">, </span><span class="hl-4">isFullscreen</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p><em>See <a href="https://github.com/modelcontextprotocol/ext-apps/tree/main/examples/shadertoy-server"><code>examples/shadertoy-server/</code></a> for a full implementation of this pattern.</em></p>
<h2 id="passing-contextual-information-from-the-app-to-the-model" class="tsd-anchor-link">Passing contextual information from the App to the Model<a href="#passing-contextual-information-from-the-app-to-the-model" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>Use <a href="../classes/app.App.html#updatemodelcontext" class="tsd-kind-method"><code>updateModelContext</code></a> to keep the model informed about what the user is viewing or interacting with. Structure the content with YAML frontmatter for easy parsing:</p>
<!-- prettier-ignore -->
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">markdown</span><span class="hl-1"> = </span><span class="hl-2">`---</span><br/><span class="hl-2">item-count: </span><span class="hl-3">${</span><span class="hl-4">itemList</span><span class="hl-18">.</span><span class="hl-4">length</span><span class="hl-3">}</span><br/><span class="hl-2">total-cost: </span><span class="hl-3">${</span><span class="hl-4">totalCost</span><span class="hl-3">}</span><br/><span class="hl-2">currency: </span><span class="hl-3">${</span><span class="hl-4">currency</span><span class="hl-3">}</span><br/><span class="hl-2">---</span><br/><br/><span class="hl-2">User is viewing their shopping cart with </span><span class="hl-3">${</span><span class="hl-4">itemList</span><span class="hl-18">.</span><span class="hl-4">length</span><span class="hl-3">}</span><span class="hl-2"> items selected:</span><br/><br/><span class="hl-3">${</span><span class="hl-4">itemList</span><span class="hl-18">.</span><span class="hl-0">map</span><span class="hl-18">((</span><span class="hl-4">item</span><span class="hl-18">) </span><span class="hl-3">=&gt;</span><span class="hl-18"> </span><span class="hl-2">`- </span><span class="hl-3">${</span><span class="hl-4">item</span><span class="hl-3">}</span><span class="hl-2">`</span><span class="hl-18">).</span><span class="hl-0">join</span><span class="hl-18">(</span><span class="hl-2">&quot;</span><span class="hl-14">\n</span><span class="hl-2">&quot;</span><span class="hl-18">)</span><span class="hl-3">}</span><span class="hl-2">`</span><span class="hl-1">;</span><br/><br/><span class="hl-9">await</span><span class="hl-1"> </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">updateModelContext</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">content:</span><span class="hl-1"> [{ </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-2">&quot;text&quot;</span><span class="hl-1">, </span><span class="hl-4">text:</span><span class="hl-1"> </span><span class="hl-4">markdown</span><span class="hl-1"> }],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><em>See <a href="https://github.com/modelcontextprotocol/ext-apps/tree/main/examples/map-server"><code>examples/map-server/</code></a> for a full implementation of this pattern.</em></p>
<h2 id="sending-large-follow-up-messages" class="tsd-anchor-link">Sending large follow-up messages<a href="#sending-large-follow-up-messages" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>When you need to send more data than fits in a message, use <a href="../classes/app.App.html#updatemodelcontext" class="tsd-kind-method"><code>updateModelContext</code></a> to set the context first, then <a href="../classes/app.App.html#sendmessage" class="tsd-kind-method"><code>sendMessage</code></a> with a brief prompt to trigger a response:</p>
<!-- prettier-ignore -->
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">markdown</span><span class="hl-1"> = </span><span class="hl-2">`---</span><br/><span class="hl-2">word-count: </span><span class="hl-3">${</span><span class="hl-4">fullTranscript</span><span class="hl-18">.</span><span class="hl-0">split</span><span class="hl-18">(</span><span class="hl-19">/\s</span><span class="hl-20">+</span><span class="hl-19">/</span><span class="hl-18">).</span><span class="hl-4">length</span><span class="hl-3">}</span><br/><span class="hl-2">speaker-names: </span><span class="hl-3">${</span><span class="hl-4">speakerNames</span><span class="hl-18">.</span><span class="hl-0">join</span><span class="hl-18">(</span><span class="hl-2">&quot;, &quot;</span><span class="hl-18">)</span><span class="hl-3">}</span><br/><span class="hl-2">---</span><br/><br/><span class="hl-3">${</span><span class="hl-4">fullTranscript</span><span class="hl-3">}</span><span class="hl-2">`</span><span class="hl-1">;</span><br/><br/><span class="hl-11">// Offload long transcript to model context</span><br/><span class="hl-9">await</span><span class="hl-1"> </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">updateModelContext</span><span class="hl-1">({ </span><span class="hl-4">content:</span><span class="hl-1"> [{ </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-2">&quot;text&quot;</span><span class="hl-1">, </span><span class="hl-4">text:</span><span class="hl-1"> </span><span class="hl-4">markdown</span><span class="hl-1"> }] });</span><br/><br/><span class="hl-11">// Send brief trigger message</span><br/><span class="hl-9">await</span><span class="hl-1"> </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">sendMessage</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;user&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">content:</span><span class="hl-1"> [{ </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-2">&quot;text&quot;</span><span class="hl-1">, </span><span class="hl-4">text:</span><span class="hl-1"> </span><span class="hl-2">&quot;Summarize the key points&quot;</span><span class="hl-1"> }],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><em>See <a href="https://github.com/modelcontextprotocol/ext-apps/tree/main/examples/transcript-server"><code>examples/transcript-server/</code></a> for a full implementation of this pattern.</em></p>
<h2 id="persisting-view-state" class="tsd-anchor-link">Persisting view state<a href="#persisting-view-state" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>To persist view state across conversation reloads (e.g., current page in a PDF viewer, camera position in a map), use <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage"><code>localStorage</code></a> with a stable identifier provided by the server.</p>
<p><strong>Server-side</strong>: Tool handler generates a unique <code>viewUUID</code> and returns it in <code>CallToolResult._meta.viewUUID</code>:</p>
<!-- prettier-ignore -->
<pre><code class="tsx"><span class="hl-11">// In your tool callback, include viewUUID in the result metadata.</span><br/><span class="hl-9">return</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">content:</span><span class="hl-1"> [{ </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-2">&quot;text&quot;</span><span class="hl-1">, </span><span class="hl-4">text:</span><span class="hl-1"> </span><span class="hl-2">`Displaying PDF viewer for &quot;</span><span class="hl-3">${</span><span class="hl-4">title</span><span class="hl-3">}</span><span class="hl-2">&quot;`</span><span class="hl-1"> }],</span><br/><span class="hl-1">  </span><span class="hl-4">structuredContent:</span><span class="hl-1"> { </span><span class="hl-4">url</span><span class="hl-1">, </span><span class="hl-4">title</span><span class="hl-1">, </span><span class="hl-4">pageCount</span><span class="hl-1">, </span><span class="hl-4">initialPage:</span><span class="hl-1"> </span><span class="hl-13">1</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-4">_meta:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">viewUUID:</span><span class="hl-1"> </span><span class="hl-0">randomUUID</span><span class="hl-1">(),</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p><strong>Client-side</strong>: Receive the UUID in <a href="../classes/app.App.html#ontoolresult" class="tsd-kind-accessor"><code>ontoolresult</code></a> and use it as the storage key:</p>
<!-- prettier-ignore -->
<pre><code class="tsx"><span class="hl-11">// In your tool callback, include viewUUID in the result metadata.</span><br/><span class="hl-9">return</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">content:</span><span class="hl-1"> [{ </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-2">&quot;text&quot;</span><span class="hl-1">, </span><span class="hl-4">text:</span><span class="hl-1"> </span><span class="hl-2">`Displaying PDF viewer for &quot;</span><span class="hl-3">${</span><span class="hl-4">title</span><span class="hl-3">}</span><span class="hl-2">&quot;`</span><span class="hl-1"> }],</span><br/><span class="hl-1">  </span><span class="hl-4">structuredContent:</span><span class="hl-1"> { </span><span class="hl-4">url</span><span class="hl-1">, </span><span class="hl-4">title</span><span class="hl-1">, </span><span class="hl-4">pageCount</span><span class="hl-1">, </span><span class="hl-4">initialPage:</span><span class="hl-1"> </span><span class="hl-13">1</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-4">_meta:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">viewUUID:</span><span class="hl-1"> </span><span class="hl-0">randomUUID</span><span class="hl-1">(),</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p><em>See <a href="https://github.com/modelcontextprotocol/ext-apps/tree/main/examples/map-server"><code>examples/map-server/</code></a> for a full implementation of this pattern.</em></p>
<h2 id="pausing-computation-heavy-views-when-out-of-view" class="tsd-anchor-link">Pausing computation-heavy views when out of view<a href="#pausing-computation-heavy-views-when-out-of-view" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>Views with animations, WebGL rendering, or polling can consume significant CPU/GPU even when scrolled out of view. Use <a href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API"><code>IntersectionObserver</code></a> to pause expensive operations when the view isn't visible:</p>
<!-- prettier-ignore -->
<pre><code class="tsx"><span class="hl-11">// Use IntersectionObserver to pause when view scrolls out of view</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-10">observer</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">IntersectionObserver</span><span class="hl-1">((</span><span class="hl-4">entries</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">entries</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">((</span><span class="hl-4">entry</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-9">if</span><span class="hl-1"> (</span><span class="hl-4">entry</span><span class="hl-1">.</span><span class="hl-4">isIntersecting</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">animation</span><span class="hl-1">.</span><span class="hl-0">play</span><span class="hl-1">();</span><br/><span class="hl-1">    } </span><span class="hl-9">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">animation</span><span class="hl-1">.</span><span class="hl-0">pause</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span><br/><span class="hl-4">observer</span><span class="hl-1">.</span><span class="hl-0">observe</span><span class="hl-1">(</span><span class="hl-4">container</span><span class="hl-1">);</span><br/><br/><span class="hl-11">// Clean up when the host tears down the view</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">onteardown</span><span class="hl-1"> = </span><span class="hl-3">async</span><span class="hl-1"> () </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">observer</span><span class="hl-1">.</span><span class="hl-0">disconnect</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-4">animation</span><span class="hl-1">.</span><span class="hl-0">pause</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-9">return</span><span class="hl-1"> {};</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p><em>See <a href="https://github.com/modelcontextprotocol/ext-apps/tree/main/examples/shadertoy-server"><code>examples/shadertoy-server/</code></a> for a full implementation of this pattern.</em></p>
<h2 id="lowering-perceived-latency" class="tsd-anchor-link">Lowering perceived latency<a href="#lowering-perceived-latency" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2>
<p>Use <a href="../classes/app.App.html#ontoolinputpartial" class="tsd-kind-accessor"><code>ontoolinputpartial</code></a> to receive streaming tool arguments as they arrive, allowing you to show a loading preview before the complete input is available.</p>
<!-- prettier-ignore -->
<pre><code class="ts"><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-4">toolInputs</span><span class="hl-1">: </span><span class="hl-12">Record</span><span class="hl-1">&lt;</span><span class="hl-12">string</span><span class="hl-1">, </span><span class="hl-12">unknown</span><span class="hl-1">&gt; | </span><span class="hl-12">null</span><span class="hl-1"> = </span><span class="hl-3">null</span><span class="hl-1">;</span><br/><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-4">toolInputsPartial</span><span class="hl-1">: </span><span class="hl-12">Record</span><span class="hl-1">&lt;</span><span class="hl-12">string</span><span class="hl-1">, </span><span class="hl-12">unknown</span><span class="hl-1">&gt; | </span><span class="hl-12">null</span><span class="hl-1"> = </span><span class="hl-3">null</span><span class="hl-1">;</span><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">ontoolinputpartial</span><span class="hl-1"> = (</span><span class="hl-4">params</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">toolInputsPartial</span><span class="hl-1"> = </span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">arguments</span><span class="hl-1"> </span><span class="hl-9">as</span><span class="hl-1"> </span><span class="hl-12">Record</span><span class="hl-1">&lt;</span><span class="hl-12">string</span><span class="hl-1">, </span><span class="hl-12">unknown</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">render</span><span class="hl-1">();</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">ontoolinput</span><span class="hl-1"> = (</span><span class="hl-4">params</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">toolInputs</span><span class="hl-1"> = </span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">arguments</span><span class="hl-1"> </span><span class="hl-9">as</span><span class="hl-1"> </span><span class="hl-12">Record</span><span class="hl-1">&lt;</span><span class="hl-12">string</span><span class="hl-1">, </span><span class="hl-12">unknown</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-4">toolInputsPartial</span><span class="hl-1"> = </span><span class="hl-3">null</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">render</span><span class="hl-1">();</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-3">function</span><span class="hl-1"> </span><span class="hl-0">render</span><span class="hl-1">() {</span><br/><span class="hl-1">  </span><span class="hl-9">if</span><span class="hl-1"> (</span><span class="hl-4">toolInputs</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">renderFinalUI</span><span class="hl-1">(</span><span class="hl-4">toolInputs</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-9">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">renderLoadingUI</span><span class="hl-1">(</span><span class="hl-4">toolInputsPartial</span><span class="hl-1">); </span><span class="hl-11">// e.g., shimmer with partial preview</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<div class="tsd-alert tsd-alert-important"><div class="tsd-alert-title"><svg width="16" height="16" viewBox="0 0 16 16" aria-hidden="true"><use href="../assets/icons.svg#icon-alertImportant"></use></svg><span>Important</span></div><p>
Partial arguments are &quot;healed&quot; JSON — the host closes unclosed brackets/braces to produce valid JSON. This means objects may be incomplete (e.g., the last item in an array may be truncated). Don't rely on partial data for critical operations; use it only for preview UI.</p>
</div>
<p><em>See <a href="https://github.com/modelcontextprotocol/ext-apps/tree/main/examples/threejs-server"><code>examples/threejs-server/</code></a> for a full implementation of this pattern.</em></p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#mcp-apps-patterns"><span>MCP <wbr/>Apps <wbr/>Patterns</span></a><ul><li><a href="#tools-that-are-private-to-apps"><span>Tools that are private to <wbr/>Apps</span></a></li><li><a href="#reading-large-amounts-of-data-via-chunked-tool-calls"><span>Reading large amounts of data via chunked tool calls</span></a></li><li><a href="#giving-errors-back-to-model"><span>Giving errors back to model</span></a></li><li><a href="#matching-host-styling-css-variables-theme-and-fonts"><span>Matching host styling (<wbr/>CSS variables, theme, and fonts)</span></a></li><li><a href="#entering-exiting-fullscreen"><span>Entering / <wbr/>Exiting fullscreen</span></a></li><li><a href="#passing-contextual-information-from-the-app-to-the-model"><span>Passing contextual information from the <wbr/>App to the <wbr/>Model</span></a></li><li><a href="#sending-large-follow-up-messages"><span>Sending large follow-<wbr/>up messages</span></a></li><li><a href="#persisting-view-state"><span>Persisting view state</span></a></li><li><a href="#pausing-computation-heavy-views-when-out-of-view"><span>Pausing computation-<wbr/>heavy views when out of view</span></a></li><li><a href="#lowering-perceived-latency"><span>Lowering perceived latency</span></a></li></ul></div></details></div><div class="site-menu"><nav id="tsd-sidebar-links" class="tsd-navigation"><a href="https://github.com/modelcontextprotocol/ext-apps" class="tsd-nav-link">GitHub</a><a href="https://github.com/modelcontextprotocol/ext-apps/blob/main/specification/2026-01-26/apps.mdx" class="tsd-nav-link">Specification</a></nav><nav class="tsd-navigation"><a href="../modules.html">@modelcontextprotocol/ext-apps - v1.0.0</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a> with <a href="https://github.com/JulianWowra/typedoc-github-theme" target="_blank">typedoc-github-theme</a></p></footer><div class="overlay"></div></body></html>
